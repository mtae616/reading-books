# 메세지 인증 코드

- MAC의 대표적 예, 무상태성 쿠키
  - (키 + 메세지) * 해시 = 인증 태그 
- MAC 의 보안 속성
  - 인증 태그의 위조 방지
    - 비밀 키가 노출되지 않는 한 위조로부터 보호받을 수 있음
  - 인증 태그의 길이
    - 충돌 방지
    - 128 비트 인증 태그는 충분한 저항성을 가진다.
  - 리플레이 공격
    - 키가 고정되어 있는 경우 replay 해서 보낼 수 있음
    - 이를 방지하기 위해 counter 를 하나 두고 키를 순환할 수 있음
    - 카운터는 64비트로 고정되는 길이를 가지는 경우가 많고, 이는 2^64 만큼의 메세지를 보낼 수 있음
  - 주기적 인증 태그 검증
  - MAC의 보안성은 해시 함수의 보안성에 의존함
    - 인증 태그 검증은 수신한 인증 태그와 계산한 인증 태그의 비교가 상수 시간에 이루어 져야 한다.
    - 올바른 크기라고 가정할 때 비교에 항상 동일한 시간이 소요되어야 한다.
    - 만약 검증되는 시간이 다르다면 검증에 걸리는 시간을 측정하여 유효한 인증 태그를 바이트 단위로 다시 생성해서 공격하는 것이 가능하다
    - 이러한 공격을 타이밍 공격이라고 한다
- 실세계의 MAC
  - 메세지 인증 : MAC
  - 키 파생 : HMAC
  - 쿠키의 정합성
  - 해시 테이블 : MAC 으로 해시 테이블을 노출시키지 않도록 보호
- 실무에서의 MAC
  - 해시기반 MAC, HMAC
    - 생성 과정
      - 두 개의 키를 생성한다.
      - 키 k1 을 메세지와 연결하고 해시한다.
      - 2의 결과를 키 k2 와 연결하고 한번 더 해시한다.
      - 최종 인증 태그를 생성한다.
  - cSHAKE 기반 MAC, KMAC
    - SHA-3 은 길이 확장 공격에 취약하지 않아 굳이 SHA-3 와 HMAC 을 함께 쓸 필요 없이 SHA-3-256(key || message) 로 이뤄진 것이 kmac
- SHA-2 와 가변 길이 공격
  - SHA-2 는 길이 확장 공격에 저항성을 가지지 못하므로 SHA-2 로 비밀을 해시해서는 안된다.
    - 머클 담고르 구조로 input 값만 알고 key 의 길이를 알면 길이 확장 공격에 취약해짐
  - 이때 비밀키를 추가하면 MAC 과 같은 보안성을 가질 수 있다.
  - => HMAC