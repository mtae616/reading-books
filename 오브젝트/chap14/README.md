# 일관성 있는 협력
- 객체들의 협력이 전체적으로 일관성 있는 유사한 패턴을 따른다면 시스템을 이해하고 확장하기 위해 요구되는 정신적인 부담을 크게 줄일 수 있다

## 설계에 일관성 부여하기
- 다양한 설계 경험을 익히는 것이 도움이 된다.
- 널리 알려진 디자인 패턴을 학습하고 변경이라는 문맥 안에서 디자인 패턴을 적용해 본다.
- 협력을 일관성 있게 만들기 위한 기본 지침
  - 변하는 개념을 변하지 않는 개념으로부터 분리하라
  - 변하는 개념을 캡슐화하라
  - 훌륭한 추상화를 찾아 추상화에 의존하도록 한다.
    - 추상화에 대한 의존은 결합도를 낮추고 결과적으로 대체 가능한 역할로 구성된 협력을 설계할 수 있게 해준다
- 객체지향에서 변경을 다루는 전통적인 방법은 조건 로직을 객체 사이의 이동으로 바꾸는 것이다.
  - 서브타이핑 한다. (계층을 위한 상속, 인터페이스를 implementation 하는 다형성)
  - 큰 메서드 안에 뭉쳐있던 조건 로직들을 변경의 압력에 맞춰 작은 클래스들로 분리하면 인스턴스들 사이의 협력 패턴에 일관성을 부여하기가 더 쉬워진다.
    - 유사한 행동을 수행하는 작은 클래스들이 자연스럽게 역할이라는 추상화로 묶이게 되고 역할 사이에서 이뤄지는 협력 방식이 전체 설계의 일관성을 유지할 수 있게 이끌어주기 때문에
- 캡슐화 다시 살펴보기
  - 데이터 은닉
    - 오직 외부에 공개된 메서드를 통해서만 객체의 내부에 접근할 수 있게 제한함으로써 객체 내부의 상태 구현을 숨기는 기법
  - 캡슐화는 데이터 은닉 이상이다.
    - 소프트웨어 안에서 변할 수 있는 모든 개념을 감추는 것
    - 변하는 어떤 것이든 감추는 것이다.
    - 가장 대표적인 예는 객체의 퍼블릭 인터페이스와 구현을 분리하는 것
  - 캡슐화의 종류
    - 데이터 캡슐화 
      - 인스턴스 변수를 private 으로 사용하면서 getter/setter 를 이용하는 것
      - 클래스 내부에 관리하는 데이터를 캡슐화
    - 메서드 캡슐화
      - method 를 protected 로 설정하면 클래스 내부와 서브클래스에서만 접근 가능
      - 따라서 클래스 외부에 영향을 미치지 않고 메서드를 수정할 수 있다 -> 클래스의 내부 행동을 캡슐화하고 있는 것
    - 객체 캡슐화
      - 인스턴스 변수를 private 로 가지는 것
      - 따라서 합성하고 있는 객체를 변경하더라도 외부에는 영향을 미치지 않는다.
      - 객체와 객체 사이의 관계를 캡슐화한다.
    - 서브타입 캡슐화
      - 인터페이스를 구현하고 있는 구현 클래스의 존재를 감추는 것
      - 서브타입 의 종류를 캡슐화 -> 다형성의 기반
- 코드 수정으로 인한 파급효과를 제어할 수 있는 모든 기법이 캡슐화의 일종
- 서브타입 캡슐화와 객체 캡슐화를 적용하는 방법
  - 변하는 부분을 분리해서 타입 계층을 만든다.
    - 변하지 않는 부분으로부터 변하는 부분을 분리해서 공통적인 행동을 추상 클래스나 인터페이스로 추상화한다.
    - 변하는 부분들이 이 추상클래스나 인터페이스를 상속 받게 만든다.
    - DiscountPolicy 를 추상 클래스로, DiscountCondition 을 인터페이스로
  - 변하지 않는 부분의 일부로 타입 계층을 합성한다.
    - 변하지 않는 부분에 합성한다.
    - Movie - DiscountPolicy
